<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">Prodiga users</ui:define>
    <ui:define name="viewname">
        <li>Pages</li>
        <li>/</li>
        <li><p:link outcome="/user/users">Users</p:link></li>
    </ui:define>

    <ui:define name="content">
        <div class="ui-g">
            <div class="ui-g-12">
                <div class="card">
                    <h1>Users</h1>
                    <h:form id="userForm">
                        <p:dataTable id="usersTable" var="user" value="#{userListController.users}">
                            <p:column headerText="Username">
                                <h:outputText value="#{user.username}"/>
                            </p:column>
                            <p:column headerText="First Name">
                                <h:outputText value="#{user.firstName}"/>
                            </p:column>
                            <p:column headerText="Last Name">
                                <h:outputText value="#{user.lastName}"/>
                            </p:column>
                            <p:column headerText="Roles">
                                <h:outputText value="#{user.roles}" />
                            </p:column>
                            <p:column headerText="Enabled">
                                <h:selectBooleanCheckbox value="#{user.enabled}" disabled="true"/>
                            </p:column>
                            <p:column style="width:100px;text-align: center">
                                <p:commandButton update=":userForm:userEditDialog" oncomplete="PF('userEditDialog').show()" icon="fa fa-fw fa-edit" title="Edit">
                                    <f:setPropertyActionListener value="#{user}" target="#{userDetailController.user}" />
                                </p:commandButton>
                                <p:commandButton action="#{userDetailController.doDeleteUser}" icon="fa fa-fw fa-trash" title="Delete" update=":userForm:usersTable">
                                    <f:setPropertyActionListener value="#{user}" target="#{userDetailController.user}" />
                                    <p:confirm header="Confirmation" message="Are you sure that you want to delete this user? You cannot undo this operation." icon="ui-icon-alert" />
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>

                        <p:dialog header="Edit User" id="userEditDialog" widgetVar="userEditDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                            <p:outputPanel id="userData" rendered="#{not empty userDetailController.user}">
                                <h:panelGrid columns="2">
                                    <p:outputLabel for="username" value="Username: " />
                                    <p:inputText id="username" value="#{userDetailController.user.username}" disabled="true"/>
                                    <p:outputLabel for="password" value="Password: " />
                                    <p:password id="password" value="#{userDetailController.user.password}" disabled="true"/>
                                </h:panelGrid>
                                <p:separator />
                                <h:panelGrid columns="2">
                                    <p:outputLabel for="firstName" value="First Name: " />
                                    <p:inputText id="firstName" value="#{userDetailController.user.firstName}"/>
                                    <p:outputLabel for="firstName" value="Last Name: " />
                                    <p:inputText id="lastName" value="#{userDetailController.user.lastName}"/>
                                    <p:outputLabel for="email" value="E-Mail: " />
                                    <p:inputText id="email" value="#{userDetailController.user.email}"/>
                                    <p:outputLabel for="phone" value="Phone: " />
                                    <p:inputMask id="phone" value="#{userDetailController.user.phone}" mask="+99? 999 9999999"/>
                                </h:panelGrid>
                                <p:separator />
                                <h:panelGrid columns="2">
                                    <p:outputLabel for="enabled" value="Enabled: " />
                                    <p:selectBooleanCheckbox id="enabled" value="#{userDetailController.user.enabled}"/>
                                    <p:outputLabel for="roles" value="Roles"/>
                                    <p:selectCheckboxMenu id="roles" value="#{userDetailController.user.rolesAsString}"
                                                          label="Roles"
                                                          filter="false" multiple="true">
                                        <f:selectItems value="#{userDetailController.allRoles}"/>
                                    </p:selectCheckboxMenu>
                                </h:panelGrid>
                                <h:panelGrid columns="2">
                                    <p:outputLabel for="enabled" value="Team: " rendered="#{userDetailController.user.assignedTeam != null}"/>
                                    <p:selectOneMenu id="teams" value="#{userDetailController.user.assignedTeam}" style="width:250px" rendered="#{userDetailController.user.assignedTeam != null}">
                                        <f:selectItem itemLabel="#{userDetailController.user.assignedTeam.name}" itemValue="#{userDetailController.user.assignedTeam}" />
                                        <f:selectItems value="#{teamController.allTeams}" var="team" itemLabel="#{team.name}" itemValue="#{team}"/>
                                    </p:selectOneMenu>
                                </h:panelGrid>
                                <h:panelGrid columns="2">
                                    <p:outputLabel for="enabled" value="Department: " rendered="#{userDetailController.user.assignedDepartment != null}"/>
                                    <p:selectOneMenu id="departments" value="#{userDetailController.user.assignedDepartment}" style="width:200px" rendered="#{userDetailController.user.assignedDepartment != null}">
                                        <f:selectItem itemLabel="#{userDetailController.user.assignedDepartment.name}" itemValue="#{userDetailController.user.assignedDepartment}" />
                                        <f:selectItems value="#{departmentController.allDepartments}" var="department" itemLabel="#{department.name}" itemValue="#{department}"/>
                                    </p:selectOneMenu>
                                </h:panelGrid>
                                <p:separator />
                                <h:panelGrid columns="3">
                                    <p:commandButton value="Save" action="#{userDetailController.doSaveUser()}" oncomplete="PF('userEditDialog').hide()" update=":userForm:usersTable"/>
                                    <p:commandButton value="Reload" action="#{userDetailController.doReloadUser(userDetailController.user)}" update=":userForm:userData"/>
                                    <p:commandButton value="Abort" onclick="PF('userEditDialog').hide()"/>
                                </h:panelGrid>
                            </p:outputPanel>
                        </p:dialog>

                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" width="300">
                            <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                        </p:confirmDialog>

                    </h:form></div>
            </div>
        </div>

    </ui:define>

</ui:composition>